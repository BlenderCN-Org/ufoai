// ==================
// HUD MAIN
// ==================

menu hud extends ahud
{
	{
		fill		true
		starlayout	true
	}

	// ==================
	// render rectangle
	// ==================
	zone render
	{
		pos			"0 0"
		size		"1024 768"
		num			10	/* fill layout */
	}

	// ==================
	// floor bar
	// ==================

	panel floor {
		{
			pos		"0 128"
			size	"40 369"
			num		4	/* float middle-left */
			excluderect	{
				pos		"33 336"
				size	"7 34"
			}
		}

		pic bar_floor
		{
			image	hud/bar_floor
			blend	true
			pos		"0 0"
			size	"40 369"
			texh	"40 369"
			ghost	true
		}

		pic bt1
		{
			tooltip	"_Level 1"
			pos		"6 289"
			texl	"0 0"
			texh	"28 36"
			mousefx	true
			click	{ cmd "cl_worldlevel 0;" }
		}
		pic bt2
		{
			tooltip	"_Level 2"
			pos		"6 249"
			texl	"32 0"
			texh	"60 36"
			mousefx	true
			click	{ cmd "cl_worldlevel 1;" }
		}
		pic bt3
		{
			tooltip	"_Level 3"
			pos		"6 209"
			texl	"64 0"
			texh	"92 36"
			mousefx	true
			click	{ cmd "cl_worldlevel 2;" }
		}
		pic bt4
		{
			tooltip	"_Level 4"
			pos		"6 169"
			texl	"96 0"
			texh	"124 36"
			mousefx	true
			click	{ cmd "cl_worldlevel 3;" }
		}
		pic bt5
		{
			tooltip	"_Level 5"
			pos		"6 129"
			texl	"0 38"
			texh	"28 74"
			mousefx	true
			click	{ cmd "cl_worldlevel 4;" }
		}
		pic bt6
		{
			tooltip	"_Level 6"
			pos		"6 89"
			texl	"32 38"
			texh	"60 74"
			mousefx	true
			click	{ cmd "cl_worldlevel 5;" }
		}
		pic bt7
		{
			tooltip	"_Level 7"
			pos		"6 49"
			texl	"64 38"
			texh	"92 74"
			mousefx	true
			click	{ cmd "cl_worldlevel 6;" }
		}
		pic bt8
		{
			tooltip	"_Level 8"
			pos		"6 9"
			texl	"96 38"
			texh	"124 74"
			mousefx	true
			click	{ cmd "cl_worldlevel 7;" }
		}

	}

	confunc disfloor { *floor.bt<1> image hud/buttons1g }
	confunc deselfloor { *floor.bt<1> image hud/buttons1 }
	confunc selfloor { *floor.bt<1> image hud/buttons1a }

	// ==================
	// actor and team bar
	// ==================

	panel soldier_selected {
		{
			pos		"0 0"
			size	"504 104"
			/** @note excluderect should be for the background, but like that we can move all the panel with the editor */
			excluderect { pos	"407 39"	size	"97 9" }
			excluderect { pos	"112 48"	size	"400 56" }
			num		1	/* float top-left */
		}

		pic background
		{
			image	hud/bar_head
			blend	true
			pos		"0 0"
			size	"504 104"
			texh	"504 104"
			ghost	true
		}

		model head
		{
			model	"*cvar mn_head"
			skin	"*cvar mn_skin"
			angles	"0 60 90"
			autoscale	true
			pos		"20 20"
			size	"74 66"
			origin	"0 0 0"
		}

		string actorname
		{
			string	"*cvar mn_name"
			pos		"130 16"
			size	"255 20"
		}
	}

	panel team_selection {
		{
			pos		"415 0"
			size	"264 56"
			num		2	/* float top-middle */
			/** @note excluderect should be for the background, but like that we can move all the panel with the editor */
			excluderect { pos	"264 17"	size	"44 40" }
			excluderect { pos	"308 28"	size	"193 28" }
		}

		pic background
		{
			image	hud/bar_teammember
			blend	true
			pos		"0 0"
			size	"501 56"
			texh	"501 56"
			ghost	true
		}

		pic bt_actor0
		{
			key		"*binding soldier_select 0"
			tooltip	"*cvar mn_soldier0_tt"
			pos		"11 10"
			texl	"0 0"
			texh	"28 36"
			mousefx	true
			click	{ cmd "soldier_select 0;" }
		}
		pic bt_actor1
		{
			key		"*binding soldier_select 1"
			tooltip	"*cvar mn_soldier1_tt"
			pos		"42 10"
			texl	"32 0"
			texh	"60 36"
			mousefx	true
			click	{ cmd "soldier_select 1;" }
		}
		pic bt_actor2
		{
			key		"*binding soldier_select 2"
			tooltip	"*cvar mn_soldier2_tt"
			pos		"73 10"
			texl	"64 0"
			texh	"92 36"
			mousefx	true
			click	{ cmd "soldier_select 2;" }
		}
		pic bt_actor3
		{
			key		"*binding soldier_select 3"
			tooltip	"*cvar mn_soldier3_tt"
			pos		"104 10"
			texl	"96 0"
			texh	"124 36"
			mousefx	true
			click	{ cmd "soldier_select 3;" }
		}
		pic bt_actor4
		{
			key		"*binding soldier_select 4"
			tooltip	"*cvar mn_soldier4_tt"
			pos		"135 10"
			texl	"0 38"
			texh	"28 74"
			mousefx	true
			click	{ cmd "soldier_select 4;" }
		}
		pic bt_actor5
		{
			key		"*binding soldier_select 5"
			tooltip	"*cvar mn_soldier5_tt"
			pos		"166 10"
			texl	"32 38"
			texh	"60 74"
			mousefx	true
			click	{ cmd "soldier_select 5;" }
		}
		pic bt_actor6
		{
			key		"*binding soldier_select 6"
			tooltip	"*cvar mn_soldier6_tt"
			pos		"197 10"
			texl	"64 38"
			texh	"92 74"
			mousefx	true
			click	{ cmd "soldier_select 6;" }
		}
		pic bt_actor7
		{
			key		"*binding soldier_select 7"
			tooltip	"*cvar mn_soldier7_tt"
			pos		"228 10"
			texl	"96 38"
			texh	"124 74"
			mousefx	true
			click	{ cmd "soldier_select 7;" }
		}
	}

	panel next {
		{
			pos		"808 0"
			size	"216 56"
			num		3	/* float top-right */
		}

		pic bar_nextround
		{
			image	hud/bar_nextround
			blend	true
			pos		"0 0"
			size	"216 56"
			texh	"216 56"
			ghost	true
		}

		custombutton bt_nextround
		{
			key		"*binding nextround"
			tooltip	"_Finish round"
			image	menu/button_background blend true
			pos		"142 10"
			size	"64 37"
			texl	"192 0"
			icon	return
			click	{ cmd "nextround;" }
		}

		string numspotted
		{
			string	"*cvar mn_numaliensspotted"
			tooltip	"_Click to cycle through spotted enemies"
			pos		"8 11"
			size	"48 34"
			textalign	cc
			key		"*binding nextalien"
			click	{ cmd "nextalien;" }
		}
	}

	confunc hudselect { *team_selection.bt_actor<1> image hud/buttons1a }
	confunc huddeselect { *team_selection.bt_actor<1> image hud/buttons1 }
	confunc huddisable { *team_selection.bt_actor<1> image hud/buttons1g }

	// ==================
	// round events
	// ==================

	confunc startrounds
	{
		*next.bt_nextround disabled false
	}

	confunc endrounds
	{
		*next.bt_nextround disabled true
	}

	// ==================
	// weapon bars
	// ==================

	/** @note this is the right arm (at left of the screen) */
	panel right {
		{
			pos		"0 616"
			size	"256 152"
			excluderect { pos	"176 0"	size	"80 24" }
			num		7	/* float bottom-left */
		}

		pic background
		{
			image	hud/bar_leftweapon
			blend	true
			pos		"0 0"
			size	"256 152"
			texh	"256 152"
			ghost	true
		}

		pic bt_pfire
		{
			tooltip	"_Primary fire mode"
			pos		"174 34"
			texl	"0 76"
			texh	"75 128"
			mousefx	true
			click	{ cmd "list_firemodes r;mn_push_dropdown firemode_right.anchor ll hud.right.bt_pfire ul;" }
		}

		pic bt_reload
		{
			tooltip	"*cvar mn_reloadright_tt"
			image	hud/buttons2g
			blend	true
			pos		"103 104"
			texl	"0 38"
			texh	"64 74"
			mousefx	true
			click	{ cmd "reloadright;" }
			in		{ cmd "remaining_tus reload_r 1;" }
			out		{ cmd "remaining_tus reload_r 0;" }
		}

		string ammoright
		{
			string	"*cvar mn_ammoright"
			pos		"17 113"
			size	"65 20"
			textalign	uc
		}

		container right
		{
			pos		"26 32"
		}

		pic hud_bt_use_headgear
		{
			tooltip	"_Use headgear"
			image	hud/buttons2g
			blend	true
			pos		"180 104"
			texl	"64 0"
			texh	"128 37"
			mousefx	true
			click	{ cmd "useheadgear;" }
		}
	}

	/** @note this is the left arm (at right of the screen) */
	panel left {
		{
			pos		"768 616"
			size	"256 152"
			num		9	/* float bottom-right */
			excluderect { pos	"0 0"	size	"80 24" }
		}

		pic background
		{
			image	hud/bar_rightweapon
			blend	true
			pos		"0 0"
			size	"256 152"
			texh	"256 152"
			ghost	true
		}

		pic bt_pfire
		{
			tooltip	"_Use Item"
			pos		"8 34"
			texl	"0 76"
			texh	"75 128"
			mousefx	true
			click	{ cmd "list_firemodes l;mn_push_dropdown firemode_left.anchor lr hud.left.bt_pfire ur;" }
		}

		pic bt_reload
		{
			tooltip	"*cvar mn_reloadleft_tt"
			image	hud/buttons2g
			blend	true
			pos		"89 104"
			texl	"0 38"
			texh	"64 74"
			mousefx	true
			click	{ cmd "reloadleft;" }
			in		{ cmd "remaining_tus reload_l 1;" }
			out		{ cmd "remaining_tus reload_l 0;" }
		}

		string ammoleft
		{
			string	"*cvar mn_ammoleft"
			pos		"171 116"
			size	"65 20"
			textalign	uc
		}

		container left
		{
			pos		"108 32"
		}

		pic bt_duck
		{
			key		"*binding standcrouch"
			tooltip	"*cvar mn_crouchstand_tt"

			image	hud/buttons2g
			blend	true
			pos		"8 107"
			texl	"0 75"
			texh	"52 112"
			click	{ cmd "standcrouch;" }
			in		{ cmd "remaining_tus crouch 1;" }
			out		{ cmd "remaining_tus crouch 0;" }
		}

		checkbox bt_crouch_reservation
		{
			tooltip	"*cvar mn_crouch_reservation_tt"
			image	"menu/checkbox_blue"
			pos		"60 107"
			size	"20 18"
			current	0
			change	{ cmd "togglecrouchreserve;" }
		}
	}

	confunc selpls { *left.bt_pfire   image hud/buttons1a }
	confunc selprs { *right.bt_pfire  image hud/buttons1a }

	confunc deselpls { *left.bt_pfire   image hud/buttons1 }
	confunc deselprs { *right.bt_pfire  image hud/buttons1 }
	confunc deselrls { *left.bt_reload  image hud/buttons2 }
	confunc deselrrs { *right.bt_reload image hud/buttons2 }

	confunc displs { *left.bt_pfire   image hud/buttons1g }
	confunc disprs { *right.bt_pfire  image hud/buttons1g }
	confunc disrls { *left.bt_reload  image hud/buttons2g }
	confunc disrrs { *right.bt_reload image hud/buttons2g }

	confunc hud_deselheadgear { *right.hud_bt_use_headgear image hud/buttons2 }
	confunc hud_disheadgear { *right.hud_bt_use_headgear image hud/buttons2g }

	// ==================
	// info bar
	// ==================

	panel info {
		{
			pos		"292 649"
			size	"457 119"
			num		8	/* float bottom-middle */
			excluderect { pos	"0 0"	size	"73 9" }
		}

		pic background
		{
			image	hud/bar_infoscreen
			blend	true
			pos		"0 0"
			size	"457 119"
			texh	"457 119"
			ghost	true
		}

		pic bt_shot_reservation
		{
			tooltip	"*cvar mn_shot_reservation_tt"
			// key "*binding sel_shotreservation"
			image hud/button_reserve_shot
			blend true
			pos		"11 32"
			texl	"64 32"	// Inital pic - will be overwritten once the game's completely started.
			texh	"115 64"
			mousefx	true
			click	{ cmd "sel_shotreservation;" }
			rclick	{ cmd "sel_shotreservation 0;" }
		}

		pic bt_reaction_s
		{
			image	hud/button_guard
			blend	true
			key		"*binding togglereaction"
			pos		"11 74"
			texl	"0 32"	// Inital pic - will be overwritten once the game's compeletly started.
			texh	"31 63"
			mousefx	true
			click	{ cmd "togglereaction;" }
		}

		string tus
		{
			string	"*cvar mn_tu"
			pos		"85 11"
			size	"40 20"
			textalign	uc
		}

		string hp
		{
			string	"*cvar mn_hp"
			pos		"85 25"
			size	"40 20"
			textalign	uc
		}

		//todo: make this into a "zone" node (which currently doesn't seem to support tooltips) See also menu_althud.
		string tu_tooltips
		{
			string	" "
			tooltip	"*cvar mn_tu_tooltips"
			pos		"130 21"
			size	"305 6"
			in
		}

		bar timeall
		{
			pos		"130 21"
			size	"305 6"
			color	".1 .1 .7 1"
			current	"*cvar mn_tu"
			max		"*cvar mn_tumax"
		}
		bar timeremain
		{
			pos		"130 21"
			size	"305 6"
			color	".2 .2 1 1"
			current	"*cvar mn_turemain"
			max		"*cvar mn_tumax"
		}

		bar timereserved
		{
			pos		"130 21"
			size	"305 3"
			color	"0 .5 0 1"
			current	"*cvar mn_tureserved"
			max		"*cvar mn_tumax"
		}

		bar health
		{
			pos		"130 34"
			size	"305 6"
			color	"1 0 0 1"
			current	"*cvar mn_hp"
			max		"*cvar mn_hpmax"
		}

		bar stun
		{
			pos		"130 34"
			size	"305 6"
			color	".3 .3 .3 .9"
			current	"*cvar mn_stun"
			max		"*cvar mn_hpmax"
		}

		string moral_text
		{
			string	"*cvar mn_morale"
			pos		"85 38"
			size	"40 20"
			textalign	uc
		}

		bar morale
		{
			pos		"130 46"
			size	"305 6"
			color	"1 1 0.5 1"
			current	"*cvar mn_morale"
			max		"*cvar mn_moralemax"
		}

		text infoscreen
		{
			textid		TEXT_STANDARD
			pos			"118 61"
			size		"290 50"
			lineheight	20
			tabwidth	100
			rows		"2"
		}
	}

	// CROUCH/STAND UP BUTTON
	confunc deselstands { *left.bt_duck texl "52 75" *left.bt_duck texh "104 112" *left.bt_duck image hud/buttons2 }
	confunc deselcrouchs { *left.bt_duck texl "0 75" *left.bt_duck texh "52 112" *left.bt_duck image hud/buttons2 }
	confunc disstands { *left.bt_duck texl "52 75" *left.bt_duck texh "104 112" *left.bt_duck image hud/buttons2g }
	confunc discrouchs { *left.bt_duck texl "0 75" *left.bt_duck texh "52 112" *left.bt_duck image hud/buttons2g }

	confunc crouch_checkbox_disable_s {
		*left.bt_crouch_reservation disabled true
	}
	confunc crouch_checkbox_clear_s	{
		*left.bt_crouch_reservation disabled false
		*(checkbox)left.bt_crouch_reservation current 0
	}
	confunc crouch_checkbox_check_s	{
		*left.bt_crouch_reservation disabled false
		*(checkbox)left.bt_crouch_reservation current 1
	}


	// "RESERVATION FOR SHOT" BUTTON
	confunc reserve_shot_clear_s
	{
		*info.bt_shot_reservation texl	"0 0"
		*info.bt_shot_reservation texh	"51 32"
	}
	confunc reserve_shot_check_s
	{
		*info.bt_shot_reservation texl	"0 32"
		*info.bt_shot_reservation texh	"51 64"
	}
	confunc reserve_shot_disable_s
	{
		*info.bt_shot_reservation texl	"64 32"
		*info.bt_shot_reservation texh	"115 64"
	}

	// REACTION MODE BUTTON
	confunc startreactionmanys
	{
		*info.bt_reaction_s texl	"0 96"
		*info.bt_reaction_s texh	"31 127"
		*info.bt_reaction_s tooltip "_Multiple-shot reaction fire"
	}
	confunc startreactionmanys_impos
	{
		*info.bt_reaction_s texl	"32 96"
		*info.bt_reaction_s texh	"63 127"
		*info.bt_reaction_s tooltip "_Multiple-shot reaction fire (Not possible)"
	}
	confunc startreactiononces
	{
		*info.bt_reaction_s texl	"0 64"
		*info.bt_reaction_s texh	"31 95"
		*info.bt_reaction_s tooltip "_One-shot reaction fire"
	}
	confunc startreactiononces_impos
	{
		*info.bt_reaction_s texl	"32 64"
		*info.bt_reaction_s texh	"63 95"
		*info.bt_reaction_s tooltip "_One-shot reaction fire (Not possible)"
	}
	confunc deselreactions
	{
		*info.bt_reaction_s texl	"0 32"
		*info.bt_reaction_s texh	"31 63"
		*info.bt_reaction_s tooltip "_No reaction fire"
	}
	confunc disreactions {
		*info.bt_reaction_s texl	"0 0"
		*info.bt_reaction_s texh	"31 31"
	}

	// ==================
	// right popup bar
	// ==================

	panel popup {
		{
			pos		"977 129"
			size	"47 335"
			num		6	/* float bottom-right */
			excluderect { pos	"0 95"	size	"8 33" }
			excluderect { pos	"0 223"	size	"16 16" }
		}

		pic background
		{
			image	hud/bar_popup
			blend	true
			pos		"0 0"
			size	"47 335"
			texh	"47 335"
			ghost	true
		}

		pic bt_game
		{
			tooltip	"_Options"
			image	hud/buttons1
			mousefx true
			pos		"6 10"
			texl	"165 0"
			texh	"201 75"
			click	{ cmd "mn_pop;" }
		}

		pic bt_physdata
		{
			tooltip	"_Physical stats of this soldier"
			image	hud/buttons1
			mousefx true
			pos		"6 137"
			texl	"202 0"
			texh	"238 75"
			click	{ cmd "mn_push hudphysdat;" }
		}

		pic bt_inventory
		{
			tooltip	"_Inventory"
			image	hud/buttons1
			mousefx true
			pos		"6 247"
			texl	"128 0"
			texh	"164 75"
			click	{ cmd "mn_push hudinv;" }
		}
	}

	// ==================
	// CHAT BUTTONS
	// ==================

	// the name must be the same in all huds
	text chatscreen
	{
		textid		TEXT_CHAT_WINDOW
		pos			"130 70"
		size		"690 48"
		font		f_verysmall
		rows		"3"
		lineheight	"16"
		padding		5
		bordercolor	"0.5 0.5 0.5 1"
		border		2
		bgcolor		"0 0.1 0 0.8"
		wheel
		in			{ cmd "unhide_chatscreen;" }
	}

	panel chat {
		{
			visiblewhen	"*cvar:sv_maxclients >= 2"
			pos		"768 64"
			size	"256 463"	/* popup height 335+64*2*/
			ghost	true
			num		6	/* middle-right float */
		}

		pic bar_chat_bg
		{
			image		hud/bar_chat
			pos			"192 0"
			size		"64 64"
		}
		pic bar_chat_all
		{
			visiblewhen	"*cvar:mn_showchatbuttons == 1"

			tooltip		"_Chat"
			key			"*binding messagesay"
			image		hud/button_chat
			pos			"176 12"
			size		"32 32"
			texl		"0 0"
			texh		"32 32"
			click		{ cmd "messagesay;" }
		}
		pic bar_chat_team
		{
			visiblewhen	"*cvar:mn_showchatbuttons == 1"
			tooltip		"_Teamchat"
			key			"*binding messagesayteam"
			image		hud/button_chat
			pos			"138 12"
			size		"32 32"
			texl		"32 0"
			texh		"64 32"
			click		{ cmd "messagesayteam;" }
		}
		pic bar_chat_show
		{
			visiblewhen	"*cvar:mn_showchatbuttons == 1"
			tooltip		"_Show chat history"
			key			"*binding showchat"
			image		hud/button_chat
			pos			"100 12"
			size		"32 32"
			texl		"64 0"
			texh		"96 32"
			mousefx		false
			out			{
				*chatscreen size "690 48"
				*chatscreen rows "3"
				*(func)event timeout 10000
			}
			in			{
				*chatscreen size "690 400"
				*chatscreen rows "25"
				*(func)event timeout 0
				cmd "mn_unhidenode chatscreen;"
			}
		}

		pic button_chat
		{
			tooltip		"_Chat messages"
			image		hud/event_log
			pos			"217 6"
			texl		"0 0"
			texh		"32 36"
			mousefx		false
			in {
				*path:this	texl	"0 36"
				*path:this	texh	"32 72"
			}
			out {
				*path:this	texl	"0 0"
				*path:this	texh	"32 36"
			}
			click		{
				if "*cvar:mn_showchatbuttons != 0" {
					*path:parent.bar_chat_bg image hud/bar_chat
					*path:parent.bar_chat_bg pos "192 0"
					*path:parent.bar_chat_bg size "64 64"
					*cvar:mn_showchatbuttons 0
				} else {
					*path:parent.bar_chat_bg image hud/bar_chat_choice
					*path:parent.bar_chat_bg pos "0 0"
					*path:parent.bar_chat_bg size "256 64"
					*cvar:mn_showchatbuttons 1
				}
			}
		}
	}

	confunc unhide_chatscreen
	{
		*chatscreen invis false
	}
	confunc hide_chatscreen
	{
		*chatscreen invis true
	}

	func event
	{
		timeout	10000
		cmd "hide_chatscreen;"
	}

	// ==================
	// init function
	// ==================

	func init
	{
		cmd "music_change battlescape;"
		cmd "set hud_refresh 1;"
		cmd "set mn_showchatbuttons 0;"
	}
}
