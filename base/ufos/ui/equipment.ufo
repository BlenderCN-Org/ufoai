// ==================
// EQUIPMENT MENU
// ==================

component equipSoldier extends panel {
	{
		size		"260 25"
	}

	data id {
		string		""
	}

	string name {
		pos			"0 0"
		color		"0 .78 0 1"
		size		"260 25"
		onClick {
			cmd "equipment_soldierlist_select <node:parent.id@integer>;"
		}
	}
}

window equipment extends objectinfo
{
	/** @todo Remove me */
	{ } // empty properties to fix parsing problem with "image" token (behaviour or property?)


	// ==================
	// names list
	// ==================

	data selected {
	}

	panel soldiers
    {
        {
            pos			"5 10"
            size		"280 320"
        }
        panel soldierlist {
            pos			"0 0"
            size		"260 320"
            padding		6
            layout		LAYOUT_TOP_DOWN_FLOW
            wheelscrollable	true

            onViewChange {
                *node:parent.soldierlist_scroll@fullsize = <fullsize>
                *node:parent.soldierlist_scroll@current = <viewpos>
                *node:parent.soldierlist_scroll@viewsize = <viewsize>
            }
        }
        vscrollbar soldierlist_scroll {
            image		"ui/scrollbar_v_green"
            pos			"262 0"
            height		"320"
            current		0
            viewsize	8
            fullsize	50

            onChange {
                *node:parent.soldierlist@viewpos = <current>
            }
        }
        confunc equipment_soldierlist_clear {
            call *node:parent.soldierlist@removeAllChild
        }
        confunc equipment_soldierlist_add {
            call *node:parent.soldierlist@createChild("member<1>", "equipSoldier")
            *node:parent.soldierlist.member<1>.id@integer = <1>
            *node:parent.soldierlist.member<1>.name@string = <2>

            if ( *node:root.selected@integer < 0 ) {
                cmd "equipment_soldierlist_select <1>;"
                *node:root.selected@integer = <1>
            }
        }
    }
	confunc equipment_soldierlist_select {
		if ( *node:root.selected@integer >= 0 ) {
			*node:parent.soldierlist.member<node:root.selected@integer>.name@color = "0 .78 0 1"
		}
		*node:root.selected@integer = <1>
		*cvar:mn_ucn = <1>
		if ( *node:root.selected@integer >= 0 ) {
			*node:parent.soldierlist.member<1>.name@color = "1 1 1 1"
			*node:root.load_warnings@integer = 0
			cmd "ui_team_select_ucn <node:root.selected@integer>;"
			cmd "mn_updateactorload equip_actorload;"
		}
	}

	// ==================
	// category buttons
	// ==================

	confunc update_item_list {
		if ( *cvar:mn_equiptype == 0 ) {
			*node:root.equip@filter = FILTER_S_PRIMARY
			*node:root.equip_ammo@filter = FILTER_S_PRIMARY
		}
		elif ( *cvar:mn_equiptype == 1 ) {
			*node:root.equip@filter = FILTER_S_SECONDARY
			*node:root.equip_ammo@filter = FILTER_S_SECONDARY
		}
		elif ( *cvar:mn_equiptype == 2 ) {
			*node:root.equip@filter = FILTER_S_HEAVY
			*node:root.equip_ammo@filter = FILTER_S_HEAVY
		}
		elif ( *cvar:mn_equiptype == 3 ) {
			*node:root.equip@filter = FILTER_S_MISC
			*node:root.equip_ammo@filter = FILTER_S_MISC
		}
		elif ( *cvar:mn_equiptype == 4 ) {
			*node:root.equip@filter = FILTER_S_ARMOUR
			*node:root.equip_ammo@filter = FILTER_S_ARMOUR
		}
		elif ( *cvar:mn_equiptype == 5 ) {
			*node:root.equip@filter = FILTER_S_IMPLANT
			*node:root.equip_ammo@filter = FILTER_S_IMPLANT
		}
		*node:root.equip@viewpos = 0
		*node:root.equip_ammo@viewpos = 0
	}

	tab equip_type1
	{
		{
			pos		"731 10"
			size	"280 40"
			cvar	*cvar:mn_equiptype
			onChange {
				cmd	"update_item_list;"
			}
		}

		option primary {
			label	"_Primary"
			value	"0"
		}
		option secondary {
			label	"_Secondary"
			value	"1"
		}
	}
	tab equip_type2
	{
		{
			pos		"731 50"
			size	"280 40"
			cvar	*cvar:mn_equiptype
			onChange {
				cmd	"update_item_list;"
			}
		}

		option heavy {
			label	"_Heavy"
			value	"2"
		}
		option misc {
			label	"_Misc"
			value	"3"
		}
		option armour {
			label	"_Armour"
			value	"4"
		}
	}

	// ==================
	// item description
	// ==================

	panel itemdescription {
		{
			pos		"30 405"
			size	"350 336"
		}

		string itemname
		{
			string	*cvar:mn_itemname
			pos		"10 6"
			size	"330 20"
			contentalign	ALIGN_UC
		}

		item itemmodel
		{
			pos 		"0 30"
			size 		"350 100"
			src			*cvar:mn_item
			angles		"0 180 90"
			autoscale	true
		}

		text description
		{
			pos			"10 140"
			size		"310 150"
			lineheight	20
			tabwidth	190
			rows		"7"
			dataid		TEXT_ITEMDESCRIPTION
			onViewChange {
				*node:root.itemdescription.description_scroll@fullsize = <fullsize>
				*node:root.itemdescription.description_scroll@current = <viewpos>
			}
			onWheel {
				*node:root.itemdescription.description_scroll@current = <viewpos>
			}
		}
		vscrollbar description_scroll {
			image		"ui/scrollbar_v_green"
			pos			"325 140"
			height		"150"
			current		0
			viewsize	7
			fullsize	7
			hidewhenunused true
			onChange {
				*node:root.itemdescription.description@viewpos = <current>
			}
		}

		// ======================
		// useable weapon or ammo
		// ======================

		string header_item
		{
			string	"_With:"
			pos		"10 290"
			size	"100 16"
			font	"f_small"
		}

		button action_dec
		{
			pos		"120 290"
			icon	"icons/prev"
			size	"16 16"
			onClick	{ cmd "mn_decreaseitem;" }
		}

		string item_name
		{
			string	*cvar:mn_linkname
			pos		"140 290"
			size	"190 16"
			contentalign	ALIGN_CC
			font	"f_small"
		}

		button action_inc
		{
			pos		"334 290"
			icon	"icons/next"
			size	"16 16"
			onClick	{ cmd "mn_increaseitem;" }
		}

		// ==================
		// firemode
		// ==================

		string header_firemode
		{
			string	"_Firemode:"
			pos		"10 314"
			size	"100 16"
			font	"f_small"
		}

		button firemode_dec
		{
			tooltip "_Previous firemode"
			pos		"120 314"
			icon	"icons/prev"
			size	"16 16"
			onClick	{ cmd "mn_decreasefiremode;" }
		}

		string firemode_name
		{
			string	*cvar:mn_firemodename
			pos		"140 314"
			size	"190 16"
			contentalign	ALIGN_CC
			font	"f_small"
		}

		button firemode_inc
		{
			tooltip "_Next firemode"
			pos		"334 314"
			icon	"icons/next"
			size	"16 16"
			onClick	{ cmd "mn_increasefiremode;" }
		}
	}

	// ==================
	// actor stats
	// ==================
/*	panel actor_statpanel {
		{
			pos		"30 405"
			size	"350 336"
		}

		image pwr_bar_full
			{
				pos "30 27"
				src		"ui/bar_attribute_disabled"
			}
		cmpDefNamedTbar pwr {
			{
				pos "4 9"
			}
			tbar bar   { current *cvar:mn_vpwr }
			string lbl { string "_Strength:" }
			string val { string *cvar:mn_tpwr }
		}

		image spd_bar_full
			{
				pos "30 62"
				src		"ui/bar_attribute_disabled"
			}
		cmpDefNamedTbar spd {
			{
				pos "4 44"
			}
			tbar bar   { current *cvar:mn_vspd }
			string lbl { string "_Speed:" }
			string val { string *cvar:mn_tspd }
		}

		image acc_bar_full
			{
				pos "30 97"
				src		"ui/bar_attribute_disabled"
			}
		cmpDefNamedTbar acc {
			{
				pos "4 79"
			}
			tbar bar   { current *cvar:mn_vacc }
			string lbl { string "_Accuracy:" }
			string val { string *cvar:mn_tacc }
		}

		image mnd_bar_full
			{
				pos "30 132"
				src		"ui/bar_attribute_disabled"
			}
		cmpDefNamedTbar mnd {
			{
				pos "4 114"
			}
			tbar bar   { current *cvar:mn_vmnd }
			string lbl { string "_Mind:" }
			string val { string *cvar:mn_tmnd }
		}

		image cls_bar_full
			{
				pos "30 175"
				src		"ui/bar_skill_disabled"
			}
		cmpDefNamedTbar cls {
			{
				pos "4 157"
			}
			tbar bar   { current *cvar:mn_vcls image "ui/bar_skill" }
			string lbl { string "_Close Combat:" }
			string val { string *cvar:mn_tcls }
		}

		image ass_bar_full
			{
				pos "30 210"
				src		"ui/bar_skill_disabled"
			}
		cmpDefNamedTbar ass {
			{
				pos "4 192"
			}
			tbar bar   { current *cvar:mn_vass image "ui/bar_skill" }
			string lbl { string "_Assault Weapons:" }
			string val { string *cvar:mn_tass }
		}

		image snp_bar_full
			{
				pos "30 245"
				src		"ui/bar_skill_disabled"
			}
		cmpDefNamedTbar snp {
			{
				pos "4 227"
			}
			tbar bar   { current *cvar:mn_vsnp image "ui/bar_skill" }
			string lbl { string "_Sniper Rifles:" }
			string val { string *cvar:mn_tsnp }
		}

		image exp_bar_full
			{
				pos "30 280"
				src		"ui/bar_skill_disabled"
			}
		cmpDefNamedTbar exp {
			{
				pos "4 262"
			}
			tbar bar   { current *cvar:mn_vexp image "ui/bar_skill" }
			string lbl { string "_High-Explosives:" }
			string val { string *cvar:mn_texp }
		}
	}*/

	// Abilities panel
	// @TODO: Remove "mediocre" dsc text. Look at CL_ActorGetSkillString, cl_team.c
	panel abilities
	{
		{
			pos			"731 410"
			size		"200 125"
			ghost		true
		}
		StatBar strength
		{
			{
				pos		"0 0"
			}
			string label { string "_Strength" }
			bar valuebar { current *cvar:mn_vpwr }
			string valuenum { string *cvar:mn_tpwr }
		}
		StatBar speed
		{
			{
				pos		"0 30"
			}
			string label { string "_Speed" }
			bar valuebar { current *cvar:mn_vspd }
			string valuenum { string *cvar:mn_tspd }
		}
		StatBar accuracy
		{
			{
				pos		"0 60"
			}
			string label { string "_Accuracy" }
			bar valuebar { current *cvar:mn_vacc }
			string valuenum { string *cvar:mn_tacc }
		}
		StatBar mind
		{
			{
				pos		"0 90"
			}
			string label { string "_Mind" }
			bar valuebar { current *cvar:mn_vmnd }
			string valuenum { string *cvar:mn_tmnd }
		}
	}
	// Skills panel
	panel skills
	{
		{
			pos			"731 552"
			size		"200 155"
			ghost		true
		}
		StatBar cls
		{
			{
				pos		"0 0"
			}
			string label { string "_CQB" tooltip "_Close Quarters Battle" }
			bar valuebar { current *cvar:mn_vcls }
			string valuenum { string *cvar:mn_tcls }
		}
		StatBar hvy
		{
			{
				pos		"0 30"
			}
			string label { string "_Heavy" tooltip "_Heavy Weapons" }
			bar valuebar { current *cvar:mn_vhvy }
			string valuenum { string *cvar:mn_thvy }
		}
		StatBar ass
		{
			{
				pos		"0 60"
			}
			string label { string "_Assault" }
			bar valuebar { current *cvar:mn_vass }
			string valuenum { string *cvar:mn_tass }
		}
		StatBar snp
		{
			{
				pos		"0 90"
			}
			string label { string "_Sniper" }
			bar valuebar { current *cvar:mn_vsnp }
			string valuenum { string *cvar:mn_tsnp }
		}
		StatBar exp
		{
			{
				pos		"0 120"
			}
			string label { string "_Explosives" }
			bar valuebar { current *cvar:mn_vexp }
			string valuenum { string *cvar:mn_texp }
		}
	}


/*	// ==================
	// switch
	// ==================

	// @todo merge with confunc team_weapon_stats?
	func weapon_stats
	{
		if ( *cvar:mn_itemname ne "" ) {
			*node:root.itemdescription@invis = false
			*node:root.actor_statpanel@invis = true
		} else {
			// switch back to actor view
			*cvar:mn_infotype = 0
		}
	}

	// @todo merge with confunc team_actor_stats?
	func actor_stats
	{
		*node:root.itemdescription@invis = true
		*node:root.actor_statpanel@invis = false
	}

	tab info {
		{
			pos		"20 365"
			size	"355 40"
			cvar	*cvar:mn_infotype
			onChange {
				if ( *cvar:mn_infotype eq 0 ) {
					call *node:root.actor_stats
				} elif ( *cvar:mn_infotype eq 1 ) {
					call *node:root.weapon_stats
				}
			}
		}
		option abilities {
			label	"_Soldier Abilities"
			value	"0"
		}
		option weaponinfo {
			label	"_Object Info"
			value	"1"
		}
	}*/

/*	// ==================
	// inventory
	// ==================

	textentry name
	{
		string		*cvar:mn_name
		tooltip		"_Rename your unit"
		pos			"544 24"
		size		"230 20"
		onChange {
			cmd "employee_changename;"
			cmd "ui_team_fillequip;"
			cmd "update_item_list;"
			cmd "equipment_soldierlist_select <node:root.selected@integer>;"
		}
	}

	button bt_edit
	{
		tooltip		"_Rename your unit"
		icon		"icons/pen"
		pos			"781 16"
		size		"35 35"
		padding		0
		onClick		{ call *node:parent.name@edit }
	}

*/
    // Paperdoll panel
    panel paperdoll
    {
        {
            pos			"290 10"
            size		"400 418"
            bgcolor		"0 0.15 0.1 0.7"
            bordercolor	"0.58 0.81 0.758 0.7"
            border		"2"
            onMouseEnter	{
                *node:this@bgcolor = "0 0.21 0.158 0.7"
            }
            onMouseLeave	{
                *node:this@bgcolor = "0 0.15 0.1 0.7"
            }
        }
        // Top bar
        string name
        {
            string			*cvar:mn_name
            pos				"8 0"
            size			"300 25"
            font			"f_small_bold"
            color			"0.56 0.81 0.76 1"
            longlines		LONGLINES_CHOP
            contentalign	ALIGN_LL
            ghost			true
        }
        string rank
        {
            string			*cvar:mn_chrrank
            pos				"8 25"
            size			"300 15"
            font			"f_verysmall"
            color			"0.56 0.81 0.76 1"
            longlines		LONGLINES_CHOP
            contentalign	ALIGN_UL
            ghost			true
        }
/*        controls drag
        {
            pos		"0 0"
            size	"560 40"
        }
        button close
        {
            icon			"icons/windowclose"
            tooltip			"_Close"
            pos				"530 10"
            size			"18	18"
            onClick			{ cmd "ui_pop;" }
        }
        // @TODO: make next/prev soldier btns work
        button next
        {
            icon			"icons/windownext"
            tooltip			"_Next soldier"
            pos				"506 10"
            size			"18	18"
            onClick			{ cmd "nextsoldier;" }
        }
        button prev
        {
            icon			"icons/windowprev"
            tooltip			"_Previous soldier"
            pos				"482 10"
            size			"18	18"
            onClick			{ cmd "prevsoldier;" }
        }*/

        // Inventory area
        image rank_img
        {
            pos 		"10 46"
            size 		"64 64"
            src 		*cvar:mn_chrrank_img
        }
        model actor
        {
            {
                src		*cvar:mn_body
                skin	*cvar:mn_body_skin
                anim	"stand_menu"
                origin	"0 -25 0"
                angles	"0 82 90"
                scale	"5 5 5"
                pos		"86 81"
                size	"191 262"
            }
            model head
            {
                src		*cvar:mn_head
                skin	*cvar:mn_head_skin
                tag		"tag_head"
                scale	"1.0 1.0 1.0"
            }
        }
        image inv_bg
        {
            pos		"10 59"
            size	"351 349"
            src		"/ui/inv_bg"
        }

        /**
         * @sa CL_InitSkin_f
         * @sa team_initskin
         */
        selectbox skins {
            pos		"115 59"
            size	"120 40"
            cvar	*cvar:mn_body_skin
            // TODO: ui_team_changeskin is only available in the campaign cgame
            onChange { cmd "ui_team_changeskin <node:root.selected@integer> <cvar:mn_body_skin>;" }
            dataid	OPTION_SINGLEPLAYER_SKINS
        }

        button bt_deequipsoldier {
            string "_Remove all"
            pos		"220 0"
            size	"140 30"
            background	"ui/button_blue"
            color	"1 1 1 0.8"
            selectcolor "1 1 1 1"

            onClick	{
                cmd "ui_team_deequip <node:root.selected@integer>;update_item_list;"
                cmd "mn_updateactorload equip_actorload <node:root.load_warnings@integer>;"
            }
        }

    	button bt_load
        {
            pos "220 30"
            contentalign ALIGN_CL
            string	"_0/0 Kg"
            color "1 1 1 1"
            flashcolor "1 0 0 1"
            size "285 22"
            onClick { cmd "mn_updateactorload equip_actorload;" }
        }



	// ==================
	// Containers (see inventory.ufo for the definition)
	// ==================

        //container implant	{ pos "13 104"	onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container headgear	{ pos "88 85" 	onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container backpack	{ pos "236 59" 	onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container right		{ pos "13 146" 	onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container left		{ pos "236 146" onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container belt		{ pos "13 204" 	onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container holster	{ pos "285 204" onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container floor		{ pos "10 282" 	onSelect { cmd "object_update <lastselectedid> update_item_list;" } }
        container armour	{
            pos "130 131"
            color "1 1 1 0"		// active, but display it transparent
            onChange { cmd "equipment_soldierlist_select <node:root.selected@integer>;" }
            onSelect { cmd "object_update <lastselectedid> update_item_list;" }
        }

        confunc equip_actorload {
            *node:parent.bt_load@string = "<1>"
            *node:parent.bt_load@tooltip = "<2>"
            *node:root.load_warnings@integer = "<4>"
            if ( <3> > 0 ) { *node:parent.bt_load@color = "0 1 0 1" }
            elif ( <3> < 0 ) { *node:parent.bt_load@color = "1 1 0 1" }
            else { *node:parent.bt_load@color = "1 1 1 1" }
            if ( <4> > 0 ) { *node:parent.bt_load@flash = true }
            else { *node:parent.bt_load@flash = false }
        }
    }

	baseinventory equip		{
		pos						"723 90"
		size					"257 312"
		displayweapon			true
		displayammoofweapon		true
		displayunavailableitem	true
		columns					1
		onViewChange {
			*node:root.equip_scroll@current = <viewpos>
			*node:root.equip_scroll@viewsize = <viewsize>
			*node:root.equip_scroll@fullsize = <fullsize>
		}
		onSelect { cmd "object_update <lastselectedid> update_item_list 0;" }
		onChange { cmd "mn_updateactorload equip_actorload <node:root.load_warnings@integer>;" }
	}

	vscrollbar equip_scroll {
		image	"ui/scrollbar_v_green"
		pos "980 90"	height	"310"
		hidewhenunused true
		onChange {
			*node:root.equip@viewpos = <current>
		}
	}


	data load_warnings {
		integer 0
	}


	// ==================
	// additional stuff
	// ==================
	button bt_go {
		tooltip			"_Done"
		background		"buttons/large_blue"
		pos				"940 720"
		size			"64 37"
		icon			"icons/return"
		onClick {
			cmd "ui_pop;"
		}
	}

	func onWindowClosed {
		/** @note Do not define action here
		 * this close is edited by the code
		 * pushing this menu
		 */
	}

	func onWindowOpened {
		call *node:root.actor_stats
		*cvar:mn_infotype = 0
		*cvar:mn_equiptype = 0
		*cvar:mn_linkname = ""
		*cvar:mn_itemname = ""
		*node:root.selected@integer = -1

		cmd "team_initskin;"
		if ( paramCount > 0 ) {
			cmd "ui_team_fillequip <1>;"
		} else {
			cmd "ui_team_fillequip;"
		}
		cmd "update_item_list;"
	}
}
